name: lint-check-reviewdog

on: [ pull_request ]

permissions:
  contents: read
  pull-requests: write

jobs:
  test:
    name: Run Flutter Tests
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v3

      - name: Set Flutter Version Latest
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.22.0'

      - name: Install dependencies
        run: flutter pub get

      - name: Run linter
        run: flutter analyze > analysis_result.txt || true

      - name: Post lint results as comment
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const core = require('@actions/core');
            
            const analysisResults = fs.readFileSync('analysis_result.txt', 'utf8');
            const issues = analysisResults.split('\n').filter(line => line.trim() !== '');
            
            if (issues.length > 0) {
              const commentBody = `**Lint issues:**\n${issues.join('\n')}`;
              core.info(commentBody);
              core.comment(commentBody);
            }